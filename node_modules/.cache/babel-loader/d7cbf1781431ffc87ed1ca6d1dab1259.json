{"ast":null,"code":"'use strict';\n\nfunction unwrapExports(x) {\n  return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, module) {\n  return module = {\n    exports: {}\n  }, fn(module, module.exports), module.exports;\n}\n\nvar lib = createCommonjsModule(function (module, exports) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  var _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj;\n  };\n\n  var SkipValidation = exports.SkipValidation = function SkipValidation(message) {\n    this.name = \"SkipValidation\";\n    this.message = message;\n  };\n\n  var validateSingle = exports.validateSingle = function validateSingle(data, validators, multipleErrors, all, key) {\n    var errors = [];\n\n    if (typeof validators === \"function\") {\n      validators = [validators];\n    }\n\n    for (var i = 0; i < validators.length; i++) {\n      try {\n        var error = validators[i](data, all);\n\n        if (typeof error === \"string\") {\n          errors.push(error.replace(\"{value}\", data).replace(\"{key}\", key));\n        }\n      } catch (err) {\n        if (err instanceof SkipValidation) {\n          break;\n        }\n      }\n    }\n\n    if (multipleErrors === true) return errors;\n    if (errors.length > 0) return errors[0];\n  };\n\n  var validate = exports.validate = function validate(data, validators, multipleErrors) {\n    if (!validators) return;\n    var errors = {};\n    var noError = true;\n\n    if ((typeof validators === \"undefined\" ? \"undefined\" : _typeof(validators)) === \"object\" && !validators.length) {\n      for (var prop in validators) {\n        if (validators.hasOwnProperty(prop)) {\n          var error = validateSingle(data[prop], validators[prop], multipleErrors, data, prop);\n\n          if (error !== undefined) {\n            noError = false;\n          }\n\n          errors[prop] = error;\n        }\n      }\n\n      return noError ? undefined : errors;\n    }\n\n    errors = validateSingle(data, validators, multipleErrors);\n    return errors;\n  };\n\n  var required = exports.required = function required(flag, error) {\n    function isNullLike(value) {\n      return value === undefined || value === \"\" || value === null;\n    }\n\n    return function (value) {\n      if (flag && isNullLike(value)) {\n        return error || \"This field is required.\";\n      } else if (!flag && isNullLike(value)) {\n        // skip rest of the validators\n        throw new SkipValidation();\n      }\n    };\n  };\n\n  var isNumber = exports.isNumber = function isNumber(error) {\n    return function (value) {\n      if (typeof value !== \"number\" || isNaN(value)) {\n        return error || \"'{value}' is not a valid number.\";\n      }\n    };\n  };\n\n  var isString = exports.isString = function isString(error) {\n    return function (value) {\n      if (typeof value !== \"string\") {\n        return error || \"'{value}' is not a valid string.\";\n      }\n    };\n  };\n\n  var isFunction = exports.isFunction = function isFunction(error) {\n    return function (value) {\n      if (typeof value !== \"function\") {\n        return error || \"Expected a function.\";\n      }\n    };\n  };\n\n  var isObject = exports.isObject = function isObject(error) {\n    return function (value) {\n      if (value !== Object(value)) {\n        return error || \"Expected an object.\";\n      }\n    };\n  };\n\n  var isArray = exports.isArray = function isArray(error) {\n    return function (value) {\n      if (Object.prototype.toString.call(value) !== \"[object Array]\") {\n        return error || \"Expected an array.\";\n      }\n    };\n  };\n\n  var length = exports.length = function length(_length, error) {\n    return function (value) {\n      var str = value + \"\";\n\n      if (str.length !== _length) {\n        return error || \"It must be \" + _length + \" characters long.\";\n      }\n    };\n  };\n\n  var isEmail = exports.isEmail = function isEmail(error) {\n    return function (value) {\n      var pattern = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n      if (!pattern.test(value)) {\n        return error || \"Invalid email id.\";\n      }\n    };\n  };\n\n  var equalsTo = exports.equalsTo = function equalsTo(key, error) {\n    return function (value, all) {\n      if (value !== all[key]) {\n        return error || \"'{key}' and '\" + key + \"' do not match.\";\n      }\n    };\n  };\n\n  var minLength = exports.minLength = function minLength(length, error) {\n    return function (value) {\n      var str = value + \"\";\n\n      if (str.length < length) {\n        return error || \"It must be at least \" + length + \" characters long.\";\n      }\n    };\n  };\n\n  var maxLength = exports.maxLength = function maxLength(length, error) {\n    return function (value) {\n      var str = value + \"\";\n\n      if (str.length > length) {\n        return error || \"It must be at most \" + length + \" characters long.\";\n      }\n    };\n  };\n\n  var isBoolean = exports.isBoolean = function isBoolean(error) {\n    return function (value) {\n      if (value !== true && value !== false) {\n        return error || \"Invalid boolean value.\";\n      }\n    };\n  };\n\n  var within = exports.within = function within(list, error) {\n    return function (value) {\n      if (!(value instanceof Array)) {\n        value = [value];\n      }\n\n      var odds = [];\n\n      for (var index = 0; index < value.length; index++) {\n        if (list.indexOf(value[index]) === -1) {\n          odds.push(value[index]);\n        }\n      }\n\n      if (odds.length > 0) {\n        return error || \"[\" + odds + \"] do not fall under the allowed list.\";\n      }\n    };\n  };\n\n  var excludes = exports.excludes = function excludes(list, error) {\n    return function (value) {\n      if (!(value instanceof Array)) {\n        value = [value];\n      }\n\n      var odds = [];\n\n      for (var index = 0; index < value.length; index++) {\n        if (list.indexOf(value[index]) !== -1) {\n          odds.push(value[index]);\n        }\n      }\n\n      if (odds.length > 0) {\n        return error || \"[\" + odds + \"] fall under restricted values.\";\n      }\n    };\n  };\n\n  var pattern = exports.pattern = function pattern(regex, error) {\n    return function (value) {\n      if (!regex.test(value)) {\n        return error || \"'{value}' does not match with the pattern.\";\n      }\n    };\n  };\n});\nunwrapExports(lib);\nvar lib_1 = lib.SkipValidation;\nvar lib_2 = lib.validateSingle;\nvar lib_3 = lib.validate;\nvar lib_4 = lib.required;\nvar lib_5 = lib.isNumber;\nvar lib_6 = lib.isString;\nvar lib_7 = lib.isFunction;\nvar lib_8 = lib.isObject;\nvar lib_9 = lib.isArray;\nvar lib_10 = lib.length;\nvar lib_11 = lib.isEmail;\nvar lib_12 = lib.equalsTo;\nvar lib_13 = lib.minLength;\nvar lib_14 = lib.maxLength;\nvar lib_15 = lib.isBoolean;\nvar lib_16 = lib.within;\nvar lib_17 = lib.excludes;\nvar lib_18 = lib.pattern;\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar paymentType = {\n  EBANKING: \"EBANKING\",\n  MOBILE_BANKING: \"MOBILE_BANKING\",\n  CONNECT_IPS: \"CONNECT_IPS\",\n  SCT: \"SCT\",\n  KHALTI: \"KHALTI\"\n};\nvar CDN_HOST = \"https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.22.0.0.0\";\nvar ZHTML_src = CDN_HOST + \"/payment_gateway_widget.html\";\nvar INFINITY_LOADER = CDN_HOST + \"/icons/infinity-loader.svg\";\n\nvar clone = function clone(data) {\n  if (!data) return data;\n  return JSON.parse(JSON.stringify(data));\n};\n\nvar eventHandlerSchema = {\n  onSuccess: [lib_4(true), lib_7()],\n  onError: [lib_4(false), lib_7()],\n  onClose: [lib_4(false), lib_7()]\n};\nvar configSchema = {\n  publicKey: lib_4(true),\n  productUrl: lib_4(true),\n  productIdentity: lib_4(true),\n  productName: lib_4(true),\n  eventHandler: lib_4(true),\n  amount: lib_4(true),\n  merchantData: [lib_4(false), lib_8()],\n  paymentPreference: [lib_4(false), lib_9()]\n};\n\nvar KhaltiCheckout = function () {\n  function KhaltiCheckout(config) {\n    _classCallCheck(this, KhaltiCheckout);\n\n    this._widgetId = \"khalti-widget-\" + Date.now();\n    this._config = config;\n    this._widget = this.attachWidget();\n    this.listenToWidget();\n    this.paymentType = paymentType;\n    this.widgetLoaded = false;\n  }\n\n  _createClass(KhaltiCheckout, [{\n    key: \"listenToWidget\",\n    value: function listenToWidget() {\n      var _this = this;\n\n      window.addEventListener(\"message\", function (e) {\n        if (!e.data.realm) return;\n\n        if (e.data.realm === \"widgetInit\") {\n          _this.widgetInit(e.data.payload);\n        } else if (e.data.realm === 'widgetLoad' && !_this.widgetLoaded) {\n          if (e.data.payload.loaded) {\n            _this.hideLoader();\n\n            _this.widgetInit();\n\n            _this.widgetLoaded = e.data.payload.loaded;\n          }\n        } else if (!e.data.payload || e.data.payload.widget_id !== _this._widgetId) {\n          return;\n        } else {\n          var handler = \"handle_msg_\" + e.data.realm;\n\n          _this[handler](e.data.payload);\n        }\n      }, false);\n    }\n  }, {\n    key: \"msgWidget\",\n    value: function msgWidget(realm, payload) {\n      payload = clone(payload);\n      payload.widgetId = this._widgetId;\n      payload.source = \"checkout_v2.1\";\n\n      this._widget.contentWindow.postMessage({\n        realm: realm,\n        payload: payload\n      }, \"*\");\n    }\n  }, {\n    key: \"handle_msg_widgetInit\",\n    value: function handle_msg_widgetInit() {\n      this.widgetInit();\n    }\n  }, {\n    key: \"widgetInit\",\n    value: function widgetInit(data) {\n      var paymentInfo = clone(this._config);\n      delete paymentInfo.eventHandler;\n      this.msgWidget(\"paymentInfo\", paymentInfo);\n    }\n  }, {\n    key: \"diplayLoader\",\n    value: function diplayLoader() {\n      var loader = window.document.getElementById('loader' + this._widgetId);\n      loader.style.display = 'block';\n    }\n  }, {\n    key: \"hideLoader\",\n    value: function hideLoader() {\n      var loader = window.document.getElementById('loader' + this._widgetId);\n      loader.style.display = 'none';\n    }\n  }, {\n    key: \"validateConfig\",\n    value: function validateConfig() {\n      var errors = lib_3(this._config, configSchema);\n\n      if (errors) {\n        throw new Error(JSON.stringify(errors));\n      } else {\n        var _errors = lib_3(this._config.eventHandler, eventHandlerSchema);\n\n        if (_errors) {\n          throw new Error(JSON.stringify({\n            eventHandler: _errors\n          }));\n        }\n      }\n    }\n  }, {\n    key: \"handle_msg_walletPaymentVerification\",\n    value: function handle_msg_walletPaymentVerification(paymentInfo) {\n      this._config.eventHandler.onSuccess(paymentInfo);\n\n      this.hide();\n    }\n  }, {\n    key: \"handle_msg_widgetError\",\n    value: function handle_msg_widgetError(error) {\n      var errorHandler = this._config.eventHandler.onError;\n      errorHandler && errorHandler(error);\n    }\n  }, {\n    key: \"disableParentScrollbar\",\n    value: function disableParentScrollbar() {\n      this.parentOverflowValue = window.document.body.style.overflowY;\n      window.document.body.style.overflowY = \"hidden\";\n    }\n  }, {\n    key: \"enableParentScrollbar\",\n    value: function enableParentScrollbar() {\n      window.document.body.style.overflowY = this.parentOverflowValue;\n      this.parentOverflowValue = null;\n    }\n  }, {\n    key: \"show\",\n    value: function show(updates) {\n      Object.assign(this._config, updates);\n      this.validateConfig();\n      this.disableParentScrollbar();\n      this._widget.style.display = \"block\";\n\n      if (this.widgetLoaded) {\n        this.widgetInit();\n      } else {\n        this.diplayLoader();\n      }\n    }\n  }, {\n    key: \"handle_msg_hide\",\n    value: function handle_msg_hide() {\n      this.hide();\n      var closeHandler = this._config.eventHandler.onClose;\n      closeHandler && closeHandler();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.enableParentScrollbar();\n      this._widget.style.display = \"none\";\n    }\n  }, {\n    key: \"attachWidget\",\n    value: function attachWidget() {\n      var widget = window.document.createElement(\"iframe\");\n      widget.setAttribute(\"id\", this._widgetId);\n      widget.style.position = \"fixed\";\n      widget.style.display = \"none\";\n      widget.style.top = \"0\";\n      widget.style.left = \"0\";\n      widget.width = \"100%\";\n      widget.height = window.innerHeight + \"px\";\n      widget.setAttribute(\"src\", ZHTML_src);\n      widget.style.zIndex = 99999;\n      widget.setAttribute(\"frameborder\", 0);\n      widget.setAttribute(\"allowtransparency\", true);\n      var loader = window.document.createElement('div');\n      loader.setAttribute(\"id\", 'loader' + this._widgetId);\n      loader.style.width = '100%';\n      loader.style.height = '100%';\n      loader.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\n      loader.style.top = '0px';\n      loader.style.left = '0px';\n      loader.style.position = 'absolute';\n      loader.style.display = 'none';\n      loader.innerHTML = \"<img style=\\\"position:relative;left:50%;top:50%;transform:translate(-50%, -50%);z-index: 99999;\\\" src=\" + INFINITY_LOADER + \"></img>\";\n\n      if (!window.document.body.contains(loader)) {\n        window.document.body.appendChild(loader);\n      }\n\n      window.document.body.appendChild(widget);\n      return widget;\n    }\n  }]);\n\n  return KhaltiCheckout;\n}();\n\nmodule.exports = KhaltiCheckout;","map":null,"metadata":{},"sourceType":"script"}